---
alwaysApply: true
---
- name: business-logic-separation
  description: >
    يجب على النموذج الالتزام بالفصل بين منطق الأعمال ومنطق العرض.
    يُكتب منطق الأعمال (Business Logic) داخل الـ Controller فقط،
    ويُستخدم المتحكم لتمرير البيانات الأساسية القادمة من قاعدة البيانات أو الخدمات الخارجية.
    أما التفاصيل الثابتة الخاصة بالواجهة مثل اسم الصفحة، عنوان الصفحة، الأيقونات،
    أو عرض/إخفاء الأجزاء بناءً على الصلاحيات، فيجب أن تُكتب داخل ملف الـ Blade نفسه دون تمريرها من المتحكم.
    
    يمكن التحكم في عرض أو إخفاء الأجزاء حسب الصلاحيات باستخدام توجيهات Blade مثل @can أو @cannot
    أو عبر شروط تعتمد على أدوار المستخدم داخل الواجهة مباشرة.
  examples:
    bad: |
      // ❌ لا يجب تمرير عنوان الصفحة أو حالة الظهور من المتحكم
      return view('users.index', [
          'pageTitle' => 'قائمة المستخدمين',
          'showCreateButton' => auth()->user()->can('create user'),
          'users' => User::all(),
      ]);
    good: |
      // ✅ المتحكم يمرر البيانات فقط
      return view('users.index', [
          'users' => User::all(),
      ]);

      {{-- ✅ داخل ملف Blade --}}
      @extends('layouts.app')
      @section('title', 'قائمة المستخدمين')

      <x-page-header icon="users" title="قائمة المستخدمين" />

      {{-- ✅ التحكم في العرض بناءً على الصلاحيات --}}
      @can('create user')
          <x-button href="{{ route('users.create') }}">إضافة مستخدم</x-button>
      @endcan

      {{-- مثال آخر باستخدام الأدوار --}}
      @if(auth()->user()->is_admin))
          <x-admin-panel />
      @endif
