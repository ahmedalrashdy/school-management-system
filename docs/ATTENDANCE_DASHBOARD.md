# لوحة التحكم الرئيسية للحضور (Attendance Dashboard)

## نظرة عامة

لوحة تحكم شاملة لمتابعة الحضور والغياب اليومي في المدرسة، مع أدوات للمتابعة السريعة وتحديد المشاكل المحتملة.

## الوصول للوحة

**URL:** `/dashboard/attendance`

**القائمة الجانبية:** الجدولة والحضور ← الحضور والغياب

## المكونات الرئيسية

### 1. الفلاتر الرئيسية

-   **التاريخ**: اختر أي يوم لعرض بياناته (افتراضي: اليوم الحالي)
-   **المرحلة الدراسية**: فلترة حسب المرحلة (ابتدائي، متوسط، ثانوي...)
-   **الصف الدراسي**: Cascade dropdown - يتم تحديثه تلقائياً عند اختيار المرحلة
-   **زر تصفية**: يجب الضغط عليه لتطبيق الفلاتر (لا يتم التطبيق تلقائياً)
-   **زر إعادة تعيين**: إعادة جميع الفلاتر للقيم الافتراضية

### 2. لمحة سريعة عن اليوم (Today's Snapshot)

5 بطاقات إحصائية ملونة:

| البطاقة        | الوصف                        | اللون             |
| -------------- | ---------------------------- | ----------------- |
| إجمالي الطلاب  | العدد الكلي للطلاب المسجلين  | أزرق (Primary)    |
| الحضور         | الطلاب الموجودون             | أخضر (Success)    |
| الغياب         | الطلاب الغائبون أو المعذورون | أحمر (Danger)     |
| التأخير        | الطلاب المتأخرون             | برتقالي (Warning) |
| لم يتم التسجيل | الطلاب بدون أي سجل حضور      | أزرق فاتح (Info)  |

### 3. الحصص التي لم يتم تحضيرها

**الغرض:** متابعة المدرسين وضمان اكتمال تسجيل الحضور

**العرض:**

-   جدول بالحصص المجدولة التي لم يتم تسجيل الحضور فيها بالكامل
-   Lazy Loading (تحميل كسول) لتحسين الأداء
-   Skeleton loaders أثناء التحميل
-   Empty state عند عدم وجود حصص معلقة

**الأعمدة:**

-   الحصة (رقم الحصة)
-   المادة
-   الشعبة
-   اسم المدرس
-   الحالة (عدد المسجلين / إجمالي الطلاب)
-   زر "تسجيل الحضور" ينقل مباشرة لصفحة التسجيل

### 4. قائمة المتابعة الفورية للغياب

**الغرض:** تحديد الطلاب الذين يحتاجون إلى متابعة فورية

**العرض:**

-   قائمة الطلاب الغائبين لهذا اليوم
-   Lazy Loading
-   عرض 5 طلاب افتراضياً
-   زر "و n طالب آخر" لعرض الباقي

**المعلومات المعروضة:**

-   اسم الطالب
-   الصف والشعبة
-   عدد الحصص الغائب فيها
-   اسم ولي الأمر
-   رقم هاتف ولي الأمر (قابل للنقر للاتصال)
-   زر "عرض السجل" للانتقال لملف الطالب

## الميزات التقنية

### Lazy Loading

-   الجداول تستخدم `wire:init` للتحميل الكسول
-   تحسين وقت تحميل الصفحة الأولية
-   Skeleton loaders أثناء انتظار البيانات

### Event-Driven Communication

-   مكون الفلاتر يُصدر event `filtersUpdated`
-   جميع المكونات الأخرى تستمع لهذا الـ event
-   تحديث متزامن لجميع البيانات عند تطبيق الفلاتر

### Performance Optimization

-   استعلامات قاعدة البيانات محسّنة
-   استخدام Eager Loading لتجنب N+1 queries
-   Cache للسنة الدراسية النشطة

## المتطلبات

لكي تعمل اللوحة بشكل صحيح، يجب أن يكون لديك:

1. **سنة دراسية نشطة** (من لوحة السنوات الدراسية)
2. **طلاب مسجلون في شعب**
3. **جداول دراسية نشطة**
4. **بعض سجلات الحضور** (للاختبار)

## حالات الاستخدام

### 1. المشرف الأكاديمي

-   متابعة نسب الحضور اليومية
-   تحديد الأنماط في الغياب
-   التواصل مع أولياء الأمور للطلاب الغائبين

### 2. مدير المدرسة

-   نظرة شاملة على الانضباط
-   متابعة المدرسين الذين لم يسجلوا الحضور
-   إحصائيات سريعة لاتخاذ القرارات

### 3. مشرف شؤون الطلاب

-   فلترة حسب المرحلة أو الصف المسؤول عنه
-   متابعة فورية للحالات المستعجلة
-   الوصول السريع لمعلومات أولياء الأمور

## الملفات المرتبطة

### Backend

-   `app/Services/AttendanceStatsService.php`
-   `app/Services/PendingSessionsService.php`
-   `app/Livewire/Dashboard/Attendances/AttendanceDashboard.php`
-   `app/Livewire/Dashboard/Attendances/AttendanceDashboardFilters.php`
-   `app/Livewire/Dashboard/Attendances/TodayAttendanceStats.php`
-   `app/Livewire/Dashboard/Attendances/PendingAttendanceSessions.php`
-   `app/Livewire/Dashboard/Attendances/AbsenceWatchlist.php`

### Frontend

-   `resources/views/livewire/dashboard/attendances/attendance-dashboard.blade.php`
-   `resources/views/livewire/dashboard/attendances/attendance-dashboard-filters.blade.php`
-   `resources/views/livewire/dashboard/attendances/today-attendance-stats.blade.php`
-   `resources/views/livewire/dashboard/attendances/pending-attendance-sessions.blade.php`
-   `resources/views/livewire/dashboard/attendances/absence-watchlist.blade.php`

### Routes

-   `GET /dashboard/attendance` → `dashboard.attendance.dashboard`

## استكشاف الأخطاء

### المشكلة: لا تظهر أي إحصائيات

**الحل:** تأكد من وجود سنة دراسية نشطة وطلاب مسجلين

### المشكلة: الحصص المعلقة فارغة

**الحل:** تأكد من وجود جداول دراسية نشطة لليوم المحدد

### المشكلة: قائمة الغياب فارغة

**الحل:** لم يتم تسجيل أي غياب لهذا اليوم - هذا أمر جيد!

### المشكلة: الفلاتر لا تعمل

**الحل:** تأكد من الضغط على زر "تصفية" بعد اختيار القيم

## التطويرات المستقبلية المقترحة

1. تصدير البيانات إلى Excel/PDF
2. رسوم بيانية للإحصائيات
3. إرسال رسائل SMS تلقائية لأولياء الأمور
4. تقارير أسبوعية/شهرية
5. مقارنة بيانات الحضور بين الفترات
6. تنبيهات للطلاب ذوي الغياب المتكرر

## الترخيص

جزء من نظام إدارة المدرسة المتكامل
